#!/bin/bash

set -eux

MY_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

GINKGO_OPTS="$@"

# Pass all test suites to ginkgo that are not blacklisted
BLACKLIST_DIRS=${BLACKLIST_DIRS:-}
if [[ ! -z $BLACKLIST_DIRS ]]; then
    for f in cf-mysql-service/*; do
      if [[ $BLACKLIST_DIRS != *"$f"* ]]; then
        GINKGO_OPTS="$GINKGO_OPTS $f"
      fi
    done
fi

go install -v github.com/onsi/ginkgo/ginkgo

CF_COLOR=false \
CF_VERBOSE_OUTPUT=true \
ginkgo \
    -r \
    -p \
    -v \
    -keepGoing=true \
    -randomizeSuites \
    -randomizeAllSpecs \
    -trace=true \
    -slowSpecThreshold=300 \
    -failOnPending \
    $GINKGO_OPTS

